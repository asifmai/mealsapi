<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include ('partials/commonhead.ejs') %>
  </head>

  <body>
    <div class="body-wrapper">
      <%- include ('partials/navbar.ejs') %>
      <main class="pt-5 mx-lg-5">
        <div class="container-fluild mt-5">
          <div class="card mb-4">
            <!--Card content-->
            <div class="card-body d-sm-flex justify-content-between">
              <a
                href=""
                data-toggle="modal"
                data-target="#modalLoginForm"
                class="btn btn-primary ml-auto"
                type="submit"
              >
                Add Recipe Ingredient
              </a>
            </div>
          </div>
          <div class="row">
            <div class="col-12">
              <!--Card-->
              <div class="card">
                <!--Card content-->
                <div class="card-body">
                  <!-- Table  -->
                  <div class="table-responsive text-nowrap">
                    <table class="table table-hover">
                      <col width="5%" />
                      <col width="5%" />
                      <col width="15%" />
                      <col width="10%" />
                      <col width="40%" />
                      <!-- Table head -->
                      <thead class="blue-grey lighten-4">
                        <tr>
                          <th>S#</th>
                          <th>Recipe</th>
                          <th>Ingredient</th>
                          <th>Amount</th>
                          <th class="text-center">Actions</th>
                        </tr>
                      </thead>
                      <!-- Table head -->
                      <!-- Table body -->
                      <tbody>
                        <% for(var i=0; i< recipes.length; i++) {%>
                        <tr>
                          <th scope="row"><%= i+1 %></th>
                          <th><%= recipes[i].recipe.name %></th>
                          <td><%= recipes[i].ingredient.name %></td>
                          <td><%= recipes[i].amount %></td>

                          <td class="text-center">
                            <a
                              href="#"
                              data-recipeID="<%= recipes[i].recipe._id  %>"
                              data-ingredientID="<%= recipes[i].ingredient._id %>"
                              data-amount="<%= recipes[i].amount%>"
                              data-id="<%= recipes[i]._id%>"
                              class="btn btn-green btn-md waves-effect waves-light mr-3 btn-edit"
                              data-toggle="modal"
                              data-target="#modalupdateForm"
                              ><i class="far fa-edit"></i
                            ></a>
                            <a
                              href="/dashboard/deleterecipeingredient/<%= recipes[i]._id %>"
                              class="btn btn-danger btn-md waves-effect waves-light btn-delete"
                              ><i class="far fa-trash-alt"></i
                            ></a>
                          </td>
                        </tr>
                        <% } %>
                      </tbody>
                      <!-- Table body -->
                    </table>
                  </div>
                  <!-- Table  -->
                </div>
              </div>
              <!--/.Card-->
            </div>
          </div>
          <!-- Central Modal Medium Info -->
          <form
            action="/dashboard/addrecipeingredient"
            method="post"
            encType="multipart/form-data"
          >
            <div
              class="modal fade"
              id="modalLoginForm"
              tabindex="-1"
              role="dialog"
              aria-labelledby="myModalLabel"
              aria-hidden="true"
            >
              <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                  <div class="modal-header text-center">
                    <h4 class="modal-title w-100 font-weight-bold">
                      Add Recipe Ingredient
                    </h4>

                    <button
                      type="button"
                      class="close"
                      data-dismiss="modal"
                      aria-label="Close"
                    >
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>

                  <div class="modal-body mx-5">
                    <label for="form-autocomplete" class="my-2">Recipe</label>

                    <select
                      name="recipeID"
                      class="browser-default custom-select"
                    >
                      <option>Select</option>
                      <% for(var i=0; i< recipe.length; i++) {%>
                      <option value="<%= recipe[i]._id%>"
                        ><%= recipe[i].name%></option
                      >
                      <% } %>
                    </select>

                    <!-- <div class="md-form mb-5">
                    <input type="text" name="recipeID" id="form-autocomplete" class="form-control mdb-autocomplete" required>
                    <label for="form-autocomplete" class="">Recipe ID</label>
                  </div> -->
                    <label for="form-autocomplete" class="my-2"
                      >Ingredient
                    </label>
                    <select
                      name="ingredientID"
                      class="browser-default custom-select"
                    >
                      <option>Select</option>
                      <% for(var i=0; i< ingredients.length; i++) {%>
                      <option value="<%= ingredients[i]._id%>"
                        ><%= ingredients[i].name%></option
                      >
                      <% } %>
                    </select>

                    <div class="md-form mb-5">
                      <input
                        type="number"
                        name="amount"
                        id="form-autocomplete"
                        class="form-control mdb-autocomplete"
                        required
                      />
                      <label for="form-autocomplete" class="">Amount</label>
                    </div>
                  </div>
                  <div class="modal-footer d-flex justify-content-center">
                    <button class="btn btn-default">Submit</button>
                  </div>
                </div>
              </div>
            </div>
          </form>

          <form
            action="/dashboard/editrecipeingredient"
            method="post"
            encType="multipart/form-data"
          >
            <div
              class="modal fade"
              id="modalupdateForm"
              tabindex="-1"
              role="dialog"
              aria-labelledby="myModalLabel"
              aria-hidden="true"
            >
              <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                  <div class="modal-header text-center">
                    <h4 class="modal-title w-100 font-weight-bold">
                      Update RecipeIngredients
                    </h4>
                    <button
                      type="button"
                      class="close"
                      data-dismiss="modal"
                      aria-label="Close"
                    >
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body mx-5">
                    <label for="form-autocomplete" class="">RecipeID</label>
                    <div class="md-form mb-5">
                      <input
                        hidden
                        type="text"
                        name="id"
                        id="form-autocomplete"
                        class="form-control mdb-autocomplete"
                        required
                      />
                      <select
                        name="recipeID"
                        class="browser-default custom-select"
                      >
                        <% for(var i=0; i< recipe.length; i++) {%>
                        <option value="<%= recipe[i]._id%>"
                          ><%= recipe[i].name%></option
                        >
                        <% } %>
                      </select>
                    </div>
                    <label for="form-autocomplete" class="">IngredientID</label>
                    <div class="md-form mb-5">
                      <select
                        name="ingredientID"
                        class="browser-default custom-select"
                      >
                        <% for(var i=0; i< ingredients.length; i++) {%>
                        <option value="<%= ingredients[i]._id%>"
                          ><%= ingredients[i].name%></option
                        >
                        <% } %>
                      </select>
                    </div>
                    <label for="form-autocomplete" class="">Amount</label>
                    <div class="md-form mb-5">
                      <input
                        type="text"
                        name="amount"
                        id="form-autocomplete"
                        class="form-control mdb-autocomplete"
                        required
                      />
                    </div>
                  </div>
                  <div class="modal-footer d-flex justify-content-center">
                    <button class="btn btn-default">Submit</button>
                  </div>
                </div>
              </div>
            </div>
          </form>
          <!-- Central Modal Medium Info-->
        </div>
      </main>
    </div>

    <%- include ('partials/commonscripts.ejs') %>

    <script>
      $(document).ready(function () {
        $("td.createdAt").each(function (index, element) {
          var dt = $(element).text();
          var newdt = moment(dt).format("MM-DD-YY HH:mm");
          $(element).text(newdt);
        });

        $(".btn-edit").click(function (e) {
          e.preventDefault();
          console.log(ClassicEditor.instances);

          var eventId = $(this).attr("data-id");
          var eventrecipeId = $(this).attr("data-recipeID");
          var eventIngredientID = $(this).attr("data-ingredientID");
          var eventAmount = $(this).attr("data-amount");
          console.log(eventId);
          console.log(eventrecipeId);
          console.log(eventIngredientID);
          $('#modalupdateForm input[name="id"]').val(eventId);
          console.log($('#modalupdateForm select[name="recipeID"]'));
          $('#modalupdateForm select[name="recipeID"]')
            .val(eventrecipeId)
            .change();
          $('#modalupdateForm select[name="ingredientID"]')
            .val(eventIngredientID)
            .change();
          $('#modalupdateForm input[name="amount"]').val(eventAmount);
        });

        $(".btn-edit").click(function () {
          $("#modalupdateForm label").addClass("active");
        });

        $(".btn-delete").on("click", function (e) {
          e.preventDefault();
          var deleteURL = $(this).attr("href");
          swal
            .fire({
              title: "Are you sure?",
              text:
                "This recipeingredients and all the data inside will be deleted permanently!",
              type: "warning",
              showCancelButton: true,
              confirmButtonText: "Yes, delete it!",
            })
            .then(function (result) {
              if (result.value) {
                window.location.href = deleteURL;
              }
            });
        });
      });
    </script>
  </body>
</html>
